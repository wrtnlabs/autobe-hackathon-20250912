import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { posthealthcarePlatformOrganizationAdminUserCredentials } from "../../../../providers/posthealthcarePlatformOrganizationAdminUserCredentials";
import { OrganizationadminAuth } from "../../../../decorators/OrganizationadminAuth";
import { OrganizationadminPayload } from "../../../../decorators/payload/OrganizationadminPayload";
import { patchhealthcarePlatformOrganizationAdminUserCredentials } from "../../../../providers/patchhealthcarePlatformOrganizationAdminUserCredentials";
import { gethealthcarePlatformOrganizationAdminUserCredentialsUserCredentialId } from "../../../../providers/gethealthcarePlatformOrganizationAdminUserCredentialsUserCredentialId";

import { IHealthcarePlatformUserCredential } from "../../../../api/structures/IHealthcarePlatformUserCredential";
import { IPageIHealthcarePlatformUserCredential } from "../../../../api/structures/IPageIHealthcarePlatformUserCredential";

@Controller("/healthcarePlatform/organizationAdmin/userCredentials")
export class HealthcareplatformOrganizationadminUsercredentialsController {
  /**
   * Archive a new user credential value record in the
   * healthcare_platform_user_credentials table.
   *
   * This operation allows system or organization administrators to archive a
   * new credential for any user or actor covered by the healthcarePlatform's
   * authentication system. The request captures user_id, user_type
   * (systemAdmin, orgAdmin, etc.), credential_type (password, sso, certificate,
   * webauthn, etc.), credential_hash (the credential value, typically hashed),
   * and relevant timestamps.
   *
   * Archiving user credentials supports regulatory mandates, SSO rotation
   * policies, and password reuse prevention. Credential archive entries are
   * append-only and must never be edited after creation. Sensitive values, such
   * as credential_hash, must be handled securely; cleartext must never be
   * allowed. All creation events are logged to the audit trail for security and
   * compliance needs.
   *
   * Attempting to create a credential archive entry for a non-existent or
   * unauthorized user must result in a compliance-audited error. Only
   * authorized systemAdmin or organizationAdmin roles should be allowed to use
   * this endpoint.
   *
   * @param connection
   * @param body Credential record including user_id, credential type, and
   *   credential hash.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedBody()
    body: IHealthcarePlatformUserCredential.ICreate,
  ): Promise<IHealthcarePlatformUserCredential> {
    try {
      return await posthealthcarePlatformOrganizationAdminUserCredentials({
        organizationAdmin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Search and paginate archived user credential records in the
   * healthcare_platform_user_credentials table (hashes never exposed).
   *
   * This operation allows authorized system or organization administrators to
   * perform an advanced query over the user credential history stored in the
   * healthcare_platform_user_credentials table. These records support
   * compliance, regulatory, and incident response audits and should never
   * contain or expose sensitive credential material such as hashes. Any
   * returned record must omit credential_hash fields, and access is strictly
   * limited to privileged administrative roles. Non-authorized access attempts
   * should be denied and tracked in the system's audit log. This operation is
   * crucial for meeting HIPAA, SOC 2, and organizational audit requirements,
   * with a focus on security and auditability.
   *
   * @param connection
   * @param body Filter and pagination options for searching archived user
   *   credentials.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedBody()
    body: IHealthcarePlatformUserCredential.IRequest,
  ): Promise<IPageIHealthcarePlatformUserCredential.ISummary> {
    try {
      return await patchhealthcarePlatformOrganizationAdminUserCredentials({
        organizationAdmin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve details of an archived user credential entry by its ID from the
   * healthcare_platform_user_credentials table. Never expose hashes in API
   * responses.
   *
   * This operation provides secure, role-restricted access to an individual
   * archived user credential entry in the healthcare_platform_user_credentials
   * table, identified by userCredentialId (UUID). Credential archives support
   * security, compliance, and rollback workflows; API consumers must never
   * receive sensitive credential_hash fields in any response. This endpoint is
   * for use by administrative and security audit roles only, and all operations
   * must be logged for compliance. Unauthorized or inappropriate access
   * attempts should be denied with audit warning.
   *
   * @param connection
   * @param userCredentialId Unique identifier for the archived user credential
   *   record to retrieve.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":userCredentialId")
  public async at(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("userCredentialId")
    userCredentialId: string & tags.Format<"uuid">,
  ): Promise<IHealthcarePlatformUserCredential> {
    try {
      return await gethealthcarePlatformOrganizationAdminUserCredentialsUserCredentialId(
        {
          organizationAdmin,
          userCredentialId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
