# StoryField AI 비기능 요구사항 명세서

## 개요 및 비전
StoryField AI 서버의 비기능적 요구사항(Non-Functional Requirements)은 동화 생성, TTS, 이미지/오디오 처리 등 전반의 품질·성능·안정성의 기업 수준 목표를 바탕으로 정의됩니다. 본 명세서는 서비스가 사용자 및 운영자의 기대에 부응하도록, 개발팀이 구현해야 할 비즈니스 수준의 기준을 제공합니다.


## 1. 성능 목표
### 1.1 응답 시간
- WHEN 모든 요청이 정상적으로 입력될 경우, THE storyfieldAi 시스템 SHALL 모든 엔드포인트에서 2초 이내에 최초 응답을 반환한다. (단, 외부 AI 연동 작업 등 장시간 소요가 불가피한 작업은 진행 상태와 대기 시간 안내 필수)
- WHEN 동화 생성 요청이 접수될 경우, THE storyfieldAi 시스템 SHALL 60초 이내에 최종 동화(이미지/텍스트 15페이지) 전체를 완성 또는 생성 진행 상황을 반환해야 한다.
- WHEN TTS(TTS/방언 변환 포함) 요청이 접수될 경우, THE storyfieldAi 시스템 SHALL 5초 이내에 TTS 오디오 생성 작업을 시작하고, 30초 이내에 결과 오디오 URL을 제공해야 한다.

### 1.2 처리량/동시성
- THE storyfieldAi 시스템 SHALL 최소 동시 50건의 동화 생성(텍스트/오디오)이 요청될 때 응답 가능해야 한다.
- WHERE 개발 테스트(API /test/...) 구간에서는 동시 100건, 실 서비스 운영 구간은 동시 1000건 요청을 10분간 연속 처리할 수 있다.

### 1.3 용량·파일 한계
- THE storyfieldAi 시스템 SHALL 동화 1건당 15페이지, 각 페이지별 이미지와 텍스트 저장/가공 프로세스가 멈추지 않게 관리해야 한다.
- THE storyfieldAi 시스템 SHALL 한 번에 100MB 이하의 오디오 파일 업로드만을 허용해야 한다.
- THE storyfieldAi 시스템 SHALL TTS 결과 오디오/동화생성 이미지 각각 15개 URL 반환이 필수다.


## 2. 확장성 및 부하 기대치
- WHEN 사용량(동화 생성/음성 변환/이미지 처리)이 순간적으로 폭증할 경우, THE storyfieldAi 시스템 SHALL 5분 이내에 정상 서비스 용량의 2배 부하까지 자동 확장 혹은 Queue 처리 등 유연한 스케일아웃 방식을 지원해야 한다.
- IF 외부 AI API 또는 Spring S3 업로드가 일시 중단/지연될 경우, THEN THE storyfieldAi 시스템 SHALL 요청을 최대 5분간 대기 처리하며 실패시 사용자에게 정중한 안내 메시지와 재시도 옵션을 반환한다.
- WHERE 부하가 QoS 기준 이상 넘어설 경우, THE 시스템 SHALL overflow 요청을 거부하며 이유와 재시도 시점 명시


## 3. 품질보증(텍스트, 이미지, TTS)
### 3.1 동화 텍스트/이미지 품질
- THE storyfieldAi 시스템 SHALL 외부 AI의 품질 정책 및 사내 품질 리뷰 기준에 따라 심각한 오탈자, 부적절/불쾌/비속어 포함 시 결과물을 제거·재생성해야 한다.
- WHERE 15장 기준 각 이미지-텍스트 매칭이 어색할 경우, THE 시스템 SHALL 최대 3회까지 재생성 과정을 제공할 수 있다.

### 3.2 TTS 품질
- THE storyfieldAi 시스템 SHALL TTS 결과가 인식 불가(잡음, 무음)하거나 문자와 발화 내용이 불일치할 경우 자동 재처리를 수행해야 한다.
- WHERE 사용자 인증(토큰 유효성 확인) 없이 TTS/방언 서비스 이용 시 THE 시스템 SHALL 모든 요청을 거부하고 401에러(인증 실패)를 반환해야 한다.

## 4. 가용성/신뢰성 기준
- THE storyfieldAi 시스템 SHALL 연간 평균 99.9% 이상의 서비스 가용성을 준수해야 한다.
- WHEN 외부 연계(S3, AI API 등) 장애 발생 시, THE 시스템 SHALL 장애 여부를 즉시 기록하고 5분 이내 백엔드 관리자 알림을 발송해야 한다.
- THE 시스템 SHALL 제어권이 없는 외부 시스템(S3, 외부AI)이 장시간 장애일 경우에도 서비스 내부 장애와 구분하여 사용자 응답 메시지를 명확히 구분한다.

## 5. 테스트 및 모니터링 요구사항
### 5.1 테스트 가능성
- THE storyfieldAi 시스템 SHALL 모든 주요 기능별(동화 생성, 오디오 변환, 이미지 업로드) 실패/성공 시나리오별 로그를 남겨야 한다.
- WHEN /test 엔드포인트가 호출되면, THE 시스템 SHALL 실제 외부 리소스를 사용하지 않고 완전한 목업 경로 및 응답을 반환해야 한다.

### 5.2 모니터링 및 알림
- THE 시스템 SHALL 플랫폼 전역에서 API 응답 성공/실패, 응답 시간, 리소스 사용량을 실시간으로 수집·집계할 수 있어야 한다.
- THE 시스템 SHALL 비정상(서비스 불가, 외부연계거부, 토큰 검증 실패 등) 이벤트 발생시 실시간으로 로그를 수집해 관리자에게 알릴 수 있어야 한다.
- WHERE 서비스 응답 지연, 동시요청 초과, 리소스 고갈 등 예외 발생시 THE 시스템 SHALL 즉시 상세 알림 및 원인 로그를 생산해야 한다.

## 6. 지표 및 서비스 건강성 판단 기준
- THE 시스템 SHALL KPI로서 요청 성공률(99% 이상), 평균 응답 시간(동화생성: 60초 내, TTS: 30초 내), SLA 가용성(연 99.9%이상) 지표를 관리해야 한다.
- THE 시스템 SHALL 이상 징후(평균 처리시간 급증, 실패율 급증 등) 발생 시 자동 알람 및 관리자 대시보드에 시각화하여 보여줘야 한다.

## 7. 부록: 상태/품질 모니터링 플로우 (Mermaid)

```mermaid
graph LR
    A["요청도착"] --> B{"API 인증 토큰 검사"}
    B --|"성공"| C["요청 큐/처리 시작"]
    B --|"실패"| H["401 인증실패 반환"]
    C --> D{"외부연동 필요?"}
    D --|"AI/S3 연동 O"| E["외부 API 호출"]
    E --> F{"결과 반환?"}
    F --|"성공"| G["사용자에게 결과전달 및 성공로그"]
    F --|"실패"| I["실패로그 및 관리자알림"]
    D --|"AI/S3 연동 X"| G
    G --> J["서비스 KPI/지표 업데이트"]
```

[비즈니스 요구사항 명세서](./02-business-requirements.md), [유저 플로우 명세서](./03-user-flows.md), [인프라 및 운영환경 명세서](./09-environment-and-operations.md)와 본 문서를 함께 참조하여 개발팀은 StoryField AI 비기능 요구의 모든 범위를 충족시켜야 합니다.