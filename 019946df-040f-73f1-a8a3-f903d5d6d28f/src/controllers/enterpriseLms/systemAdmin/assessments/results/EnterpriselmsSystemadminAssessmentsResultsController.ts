import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { getenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId } from "../../../../../providers/getenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId";
import { SystemadminAuth } from "../../../../../decorators/SystemadminAuth";
import { SystemadminPayload } from "../../../../../decorators/payload/SystemadminPayload";
import { putenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId } from "../../../../../providers/putenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId";
import { deleteenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId } from "../../../../../providers/deleteenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId";
import { postenterpriseLmsSystemAdminAssessmentsAssessmentIdResults } from "../../../../../providers/postenterpriseLmsSystemAdminAssessmentsAssessmentIdResults";

import { IEnterpriseLmsAssessmentResult } from "../../../../../api/structures/IEnterpriseLmsAssessmentResult";

@Controller("/enterpriseLms/systemAdmin/assessments/:assessmentId/results")
export class EnterpriselmsSystemadminAssessmentsResultsController {
  /**
   * Retrieve a specific assessment result by assessmentId and resultId.
   *
   * Retrieve detailed information about a specific assessment result identified
   * by its resultId and associated with the specified assessmentId within the
   * multi-tenant Enterprise LMS system.
   *
   * This operation ensures data retrieval scoped by tenant and enforces access
   * control based on user roles. It interfaces directly with the
   * enterprise_lms_assessment_results table, fetching all recorded fields for
   * the requested assessment attempt.
   *
   * The response includes score, status, completion timestamp, and audit
   * timestamps. Authorization checks verify user permission to view this data,
   * protecting learner privacy and tenant data isolation.
   *
   * Errors include not found if the resultId does not exist or does not belong
   * to the assessmentId provided.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param resultId Unique identifier of the assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":resultId")
  public async at(
    @SystemadminAuth()
    systemAdmin: SystemadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedParam("resultId")
    resultId: string & tags.Format<"uuid">,
  ): Promise<IEnterpriseLmsAssessmentResult> {
    try {
      return await getenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId(
        {
          systemAdmin,
          assessmentId,
          resultId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update a specific assessment result by assessmentId and resultId.
   *
   * Update an existing assessment result identified by resultId for the
   * specified assessmentId.
   *
   * The update request must contain valid fields for score, status, and related
   * audit data. This operation ensures that only authorized users modify
   * allowed fields. It accesses the enterprise_lms_assessment_results table,
   * updating relevant fields and timestamps.
   *
   * Upon success, the updated assessment result is returned. Validation
   * failures or permission issues cause errors.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param resultId Unique identifier of the assessment result
   * @param body Update info for assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":resultId")
  public async update(
    @SystemadminAuth()
    systemAdmin: SystemadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedParam("resultId")
    resultId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IEnterpriseLmsAssessmentResult.IUpdate,
  ): Promise<IEnterpriseLmsAssessmentResult> {
    try {
      return await putenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId(
        {
          systemAdmin,
          assessmentId,
          resultId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Delete a specific assessment result by assessmentId and resultId.
   *
   * Permanently delete the assessment result record identified by resultId for
   * the specified assessmentId.
   *
   * This is a hard delete operation that removes the record from the database.
   * Authorization prevents unauthorized deletion. Success returns no content.
   *
   * Errors occur when the record is not found or access is denied.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param resultId Unique identifier of the assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":resultId")
  public async erase(
    @SystemadminAuth()
    systemAdmin: SystemadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedParam("resultId")
    resultId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteenterpriseLmsSystemAdminAssessmentsAssessmentIdResultsResultId(
        {
          systemAdmin,
          assessmentId,
          resultId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Create a new assessment result for a specific assessment.
   *
   * Create a new assessment result entry under the specified assessmentId to
   * record a learner's attempt, score, and completion status.
   *
   * The request must include valid scoring data and learner references as per
   * the schema. Authorization ensures only permitted roles (e.g., systemAdmin,
   * organizationAdmin, corporateLearner) can create results. The newly created
   * assessment result includes all fields to confirm data integrity and audit
   * tracking.
   *
   * Validation errors are returned if data violates schema or business rules.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param body Creation info for assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @SystemadminAuth()
    systemAdmin: SystemadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IEnterpriseLmsAssessmentResult.ICreate,
  ): Promise<IEnterpriseLmsAssessmentResult> {
    try {
      return await postenterpriseLmsSystemAdminAssessmentsAssessmentIdResults({
        systemAdmin,
        assessmentId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
