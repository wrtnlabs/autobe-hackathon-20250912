import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { postenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResults } from "../../../../../providers/postenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResults";
import { OrganizationadminAuth } from "../../../../../decorators/OrganizationadminAuth";
import { OrganizationadminPayload } from "../../../../../decorators/payload/OrganizationadminPayload";
import { patchenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResults } from "../../../../../providers/patchenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResults";
import { getenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId } from "../../../../../providers/getenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId";
import { putenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId } from "../../../../../providers/putenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId";
import { deleteenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId } from "../../../../../providers/deleteenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId";

import { IEnterpriseLmsAssessmentResult } from "../../../../../api/structures/IEnterpriseLmsAssessmentResult";
import { IPageIEnterpriseLmsAssessmentResult } from "../../../../../api/structures/IPageIEnterpriseLmsAssessmentResult";

@Controller(
  "/enterpriseLms/organizationAdmin/assessments/:assessmentId/results",
)
export class EnterpriselmsOrganizationadminAssessmentsResultsController {
  /**
   * Create a new assessment result for a specific assessment.
   *
   * Create a new assessment result entry under the specified assessmentId to
   * record a learner's attempt, score, and completion status.
   *
   * The request must include valid scoring data and learner references as per
   * the schema. Authorization ensures only permitted roles (e.g., systemAdmin,
   * organizationAdmin, corporateLearner) can create results. The newly created
   * assessment result includes all fields to confirm data integrity and audit
   * tracking.
   *
   * Validation errors are returned if data violates schema or business rules.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param body Creation info for assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IEnterpriseLmsAssessmentResult.ICreate,
  ): Promise<IEnterpriseLmsAssessmentResult> {
    try {
      return await postenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResults(
        {
          organizationAdmin,
          assessmentId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve paginated results for a specified assessment.
   *
   * Fetch a filtered, paginated list of assessment results for the assessment
   * identified by assessmentId.
   *
   * This PATCH endpoint accepts a request body specifying filtering and
   * pagination criteria as per IEnterpriseLmsAssessmentResult.IRequest schema.
   *
   * The response provides a paginated list of assessment results matching the
   * criteria.
   *
   * Roles authorized: contentCreatorInstructor, organizationAdmin.
   *
   * Tenant data isolation and security are enforced.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param body Search and pagination criteria for assessment results
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IEnterpriseLmsAssessmentResult.IRequest,
  ): Promise<IPageIEnterpriseLmsAssessmentResult> {
    try {
      return await patchenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResults(
        {
          organizationAdmin,
          assessmentId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve a specific assessment result by assessmentId and resultId.
   *
   * Retrieve detailed information about a specific assessment result identified
   * by its resultId and associated with the specified assessmentId within the
   * multi-tenant Enterprise LMS system.
   *
   * This operation ensures data retrieval scoped by tenant and enforces access
   * control based on user roles. It interfaces directly with the
   * enterprise_lms_assessment_results table, fetching all recorded fields for
   * the requested assessment attempt.
   *
   * The response includes score, status, completion timestamp, and audit
   * timestamps. Authorization checks verify user permission to view this data,
   * protecting learner privacy and tenant data isolation.
   *
   * Errors include not found if the resultId does not exist or does not belong
   * to the assessmentId provided.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param resultId Unique identifier of the assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":resultId")
  public async at(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedParam("resultId")
    resultId: string & tags.Format<"uuid">,
  ): Promise<IEnterpriseLmsAssessmentResult> {
    try {
      return await getenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId(
        {
          organizationAdmin,
          assessmentId,
          resultId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update a specific assessment result by assessmentId and resultId.
   *
   * Update an existing assessment result identified by resultId for the
   * specified assessmentId.
   *
   * The update request must contain valid fields for score, status, and related
   * audit data. This operation ensures that only authorized users modify
   * allowed fields. It accesses the enterprise_lms_assessment_results table,
   * updating relevant fields and timestamps.
   *
   * Upon success, the updated assessment result is returned. Validation
   * failures or permission issues cause errors.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param resultId Unique identifier of the assessment result
   * @param body Update info for assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":resultId")
  public async update(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedParam("resultId")
    resultId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IEnterpriseLmsAssessmentResult.IUpdate,
  ): Promise<IEnterpriseLmsAssessmentResult> {
    try {
      return await putenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId(
        {
          organizationAdmin,
          assessmentId,
          resultId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Delete a specific assessment result by assessmentId and resultId.
   *
   * Permanently delete the assessment result record identified by resultId for
   * the specified assessmentId.
   *
   * This is a hard delete operation that removes the record from the database.
   * Authorization prevents unauthorized deletion. Success returns no content.
   *
   * Errors occur when the record is not found or access is denied.
   *
   * @param connection
   * @param assessmentId Unique identifier of the target assessment
   * @param resultId Unique identifier of the assessment result
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":resultId")
  public async erase(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("assessmentId")
    assessmentId: string & tags.Format<"uuid">,
    @TypedParam("resultId")
    resultId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteenterpriseLmsOrganizationAdminAssessmentsAssessmentIdResultsResultId(
        {
          organizationAdmin,
          assessmentId,
          resultId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
