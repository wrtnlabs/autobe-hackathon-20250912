import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { posthealthcarePlatformDepartmentHeadEquipmentReservations } from "../../../../providers/posthealthcarePlatformDepartmentHeadEquipmentReservations";
import { DepartmentheadAuth } from "../../../../decorators/DepartmentheadAuth";
import { DepartmentheadPayload } from "../../../../decorators/payload/DepartmentheadPayload";
import { patchhealthcarePlatformDepartmentHeadEquipmentReservations } from "../../../../providers/patchhealthcarePlatformDepartmentHeadEquipmentReservations";
import { gethealthcarePlatformDepartmentHeadEquipmentReservationsEquipmentReservationId } from "../../../../providers/gethealthcarePlatformDepartmentHeadEquipmentReservationsEquipmentReservationId";
import { puthealthcarePlatformDepartmentHeadEquipmentReservationsEquipmentReservationId } from "../../../../providers/puthealthcarePlatformDepartmentHeadEquipmentReservationsEquipmentReservationId";

import { IHealthcarePlatformEquipmentReservation } from "../../../../api/structures/IHealthcarePlatformEquipmentReservation";
import { IPageIHealthcarePlatformEquipmentReservation } from "../../../../api/structures/IPageIHealthcarePlatformEquipmentReservation";

@Controller("/healthcarePlatform/departmentHead/equipmentReservations")
export class HealthcareplatformDepartmentheadEquipmentreservationsController {
  /**
   * Create a new equipment reservation for operational or clinical scheduling
   * (healthcare_platform_equipment_reservations table).
   *
   * Allows authorized organizational users to create a new reservation for a
   * piece of equipment, specifying the organization, equipment resource, time
   * slot, reservation type, and related context. It supports department and
   * org-specific scheduling flows and enforces audit compliance, including
   * timestamps, business rationale, and linkage to appointments where
   * relevant.
   *
   * Authorization logic ensures only permitted users (systemAdmin,
   * organizationAdmin, departmentHead) can create reservations in their
   * respective scopes. All entries are checked against existing reservations
   * for conflicts and must obey maintenance or blackout logic as configured in
   * the organization's settings.
   *
   * Validation occurs for time windows, required fields, resource existence,
   * and business rules such as no duplicate reservations for the same equipment
   * and slot.
   *
   * @param connection
   * @param body Equipment reservation creation details, including resource,
   *   scheduling, and organizational assignment.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @DepartmentheadAuth()
    departmentHead: DepartmentheadPayload,
    @TypedBody()
    body: IHealthcarePlatformEquipmentReservation.ICreate,
  ): Promise<IHealthcarePlatformEquipmentReservation> {
    try {
      return await posthealthcarePlatformDepartmentHeadEquipmentReservations({
        departmentHead,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Search and retrieve a paginated list of equipment reservations
   * (healthcare_platform_equipment_reservations table).
   *
   * Retrieve a filtered and paginated list of equipment reservations within the
   * healthcare platform. This supports key operational activities including
   * scheduling, maintenance, and resource allocation for procedures or
   * appointments.
   *
   * Security and access are governed by role-based permissions (e.g.,
   * systemAdmin, organizationAdmin, departmentHead), ensuring that only
   * authorized staff may view or manage reservations relevant to their
   * organizational context. Users may search by resource type, time slot,
   * resource assignment, reservation reason/type, and status.
   *
   * This operation is based on the healthcare_platform_equipment_reservations
   * table, offering all fields necessary for compliance/audit reporting and
   * workflow optimization. The response provides detailed reservation data,
   * including any linked room, appointment, or blackout period, and includes
   * pagination for scalable access.
   *
   * Related APIs include creation (POST), update (PUT), and detail retrieval
   * (GET) for single reservations. Error handling will include validation for
   * search parameters, role visibility limitations, and anti-pattern detection
   * for overlapping/conflicting reservations.
   *
   * @param connection
   * @param body Advanced search and pagination criteria for querying equipment
   *   reservations.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @DepartmentheadAuth()
    departmentHead: DepartmentheadPayload,
    @TypedBody()
    body: IHealthcarePlatformEquipmentReservation.IRequest,
  ): Promise<IPageIHealthcarePlatformEquipmentReservation> {
    try {
      return await patchhealthcarePlatformDepartmentHeadEquipmentReservations({
        departmentHead,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve a single equipment reservation's details by its unique identifier
   * (healthcare_platform_equipment_reservations table).
   *
   * Obtain the full detail of a specific equipment reservation using its unique
   * identifier. Used for schedule review, operational management, and
   * compliance auditing. Access is appropriately restricted to users in roles
   * such as systemAdmin, organizationAdmin, or departmentHead for the relevant
   * organization or department.
   *
   * All fields are returned as specified in the
   * healthcare_platform_equipment_reservations schema, including reservation
   * type, status, associated appointment, resource linkage, and timestamps.
   * Authorization is enforced at the organization/unit level according to user
   * assignments.
   *
   * Validation ensures the reservationId exists and the user has permission to
   * read it. Errors are returned for missing, deleted, or inaccessible
   * reservations.
   *
   * @param connection
   * @param equipmentReservationId Unique identifier of the equipment
   *   reservation record to retrieve.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":equipmentReservationId")
  public async at(
    @DepartmentheadAuth()
    departmentHead: DepartmentheadPayload,
    @TypedParam("equipmentReservationId")
    equipmentReservationId: string & tags.Format<"uuid">,
  ): Promise<IHealthcarePlatformEquipmentReservation> {
    try {
      return await gethealthcarePlatformDepartmentHeadEquipmentReservationsEquipmentReservationId(
        {
          departmentHead,
          equipmentReservationId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing equipment reservation record
   * (healthcare_platform_equipment_reservations table) by identifier.
   *
   * Allows authorized users (systemAdmin, organizationAdmin, departmentHead in
   * relevant org/unit) to update the details of an equipment reservation in the
   * system. Fields such as reservation window, resource identifiers, status,
   * and reason/type may be modified, and audit trails are maintained for all
   * changes.
   *
   * Validation ensures the target record exists, is active, and is modifiable
   * by the user (i.e., not archived or soft-deleted), and checks for updated
   * scheduling conflicts and compliance with organizational rules.
   *
   * Related operations include creation (POST), single record retrieval (GET),
   * and list search (PATCH) for reservations. Error conditions such as invalid
   * UUID, unauthorized edits, or scheduling conflicts are surfaced as API
   * validation errors.
   *
   * @param connection
   * @param equipmentReservationId Unique identifier of the equipment
   *   reservation to update.
   * @param body Updated fields and values for the equipment reservation.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":equipmentReservationId")
  public async update(
    @DepartmentheadAuth()
    departmentHead: DepartmentheadPayload,
    @TypedParam("equipmentReservationId")
    equipmentReservationId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IHealthcarePlatformEquipmentReservation.IUpdate,
  ): Promise<IHealthcarePlatformEquipmentReservation> {
    try {
      return await puthealthcarePlatformDepartmentHeadEquipmentReservationsEquipmentReservationId(
        {
          departmentHead,
          equipmentReservationId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
