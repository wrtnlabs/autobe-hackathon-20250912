import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { posthealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItems } from "../../../../../providers/posthealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItems";
import { OrganizationadminAuth } from "../../../../../decorators/OrganizationadminAuth";
import { OrganizationadminPayload } from "../../../../../decorators/payload/OrganizationadminPayload";
import { patchhealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItems } from "../../../../../providers/patchhealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItems";
import { gethealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId } from "../../../../../providers/gethealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId";
import { puthealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId } from "../../../../../providers/puthealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId";
import { deletehealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId } from "../../../../../providers/deletehealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId";

import { IHealthcarePlatformBillingItem } from "../../../../../api/structures/IHealthcarePlatformBillingItem";
import { IPageIHealthcarePlatformBillingItem } from "../../../../../api/structures/IPageIHealthcarePlatformBillingItem";

@Controller(
  "/healthcarePlatform/organizationAdmin/billingInvoices/:billingInvoiceId/billingItems",
)
export class HealthcareplatformOrganizationadminBillinginvoicesBillingitemsController {
  /**
   * Create a billing item for an invoice (IHealthcarePlatformBillingItem).
   *
   * This operation enables authorized billing or administrative users to create
   * a new billing item under a given invoice, as stored in the
   * healthcare_platform_billing_items table. Required details generally include
   * the billing code, quantity, item description, price, and calculation logic
   * as defined in schema columns.
   *
   * Business validation ensures that item creation is allowed only when the
   * parent invoice is active and appropriate organization and billing
   * permissions are in effect. Item creation must be fully auditable, with pre-
   * and post-validation states recorded for compliance review.
   *
   * Only authorized roles (billing staff, administrators, department heads) may
   * perform this operation. This action is typically part of broader invoice
   * creation, amendment, or post-encounter correction workflows. Related
   * endpoints are the list (PATCH), detail (GET), and update (PUT) operations.
   *
   * @param connection
   * @param billingInvoiceId Unique identifier of the billing invoice to which
   *   the new item will be added.
   * @param body Data for new billing item to be created under the specified
   *   invoice.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("billingInvoiceId")
    billingInvoiceId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IHealthcarePlatformBillingItem.ICreate,
  ): Promise<IHealthcarePlatformBillingItem> {
    try {
      return await posthealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItems(
        {
          organizationAdmin,
          billingInvoiceId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve and search billing items for a specific invoice
   * (IHealthcarePlatformBillingItem).
   *
   * Retrieves a filtered, paginated list of billing items tied to a given
   * billing invoice, as defined in the healthcare_platform_billing_items table.
   * Filtering options enable staff to locate billing items by service code,
   * amount, date, item status, and other searchable fields. Paging and result
   * ordering are required for workflows handling large, complex invoices.
   *
   * Access to this operation should be controlled so only administrators,
   * billing staff, or auditors of the organization associated with the invoice
   * can use it. Audit logs must be maintained for all access events. Related
   * endpoints include detail retrieval (GET
   * /billingInvoices/{billingInvoiceId}/billingItems/{billingItemId}), creation
   * (POST), and update (PUT).
   *
   * All filtering and sorting logic leverages column definitions and index
   * strategies from the billing items schema, providing response formats
   * suitable for UI tabular display and export.
   *
   * @param connection
   * @param billingInvoiceId Unique identifier for the billing invoice whose
   *   items are to be retrieved.
   * @param body Search and pagination options for billing items within a given
   *   invoice.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("billingInvoiceId")
    billingInvoiceId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IHealthcarePlatformBillingItem.IRequest,
  ): Promise<IPageIHealthcarePlatformBillingItem> {
    try {
      return await patchhealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItems(
        {
          organizationAdmin,
          billingInvoiceId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve detailed information for a specific billing item
   * (IHealthcarePlatformBillingItem).
   *
   * This operation fetches all the detailed attributes of a single billing item
   * as defined in the healthcare_platform_billing_items table, for the given
   * invoice. It is intended for use by billing administrators, organization
   * admins, finance, or compliance staff who need to review the complete
   * structure of the item—including service code, description, quantity,
   * pricing, and adjustment links.
   *
   * Authorization is restricted to organization administrators, designated
   * department heads, and other roles with invoice/billing access. Audit
   * logging is performed for all access.
   *
   * This endpoint supports workflows for invoice review, dispute resolution,
   * and compliance audit. Related operations include list retrieval (PATCH),
   * creation (POST), and update (PUT).
   *
   * @param connection
   * @param billingInvoiceId Unique identifier of the parent billing invoice.
   * @param billingItemId Unique identifier of the billing item to retrieve.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":billingItemId")
  public async at(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("billingInvoiceId")
    billingInvoiceId: string & tags.Format<"uuid">,
    @TypedParam("billingItemId")
    billingItemId: string & tags.Format<"uuid">,
  ): Promise<IHealthcarePlatformBillingItem> {
    try {
      return await gethealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId(
        {
          organizationAdmin,
          billingInvoiceId,
          billingItemId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing billing item linked to an invoice
   * (IHealthcarePlatformBillingItem).
   *
   * Applies updates to a billing item, referenced by its ID and parent invoice,
   * in the healthcare_platform_billing_items table. Permitted fields for update
   * include description, quantity, item code, pricing, and adjustment
   * details—subject to business logic and compliance review. Edits are logged
   * for full auditability, with before/after comparison and justification (if
   * required).
   *
   * Only billing staff, department heads, or organization administrators with
   * the correct permissions may use this operation. The endpoint supports
   * workflows for error correction, regulatory compliance, post-payment
   * reconciliation, and dispute resolution. Related endpoints include detail
   * retrieval (GET), bulk/list (PATCH), and creation (POST) operations.
   *
   * @param connection
   * @param billingInvoiceId Unique identifier of the parent billing invoice.
   * @param billingItemId Unique identifier of the billing item to update.
   * @param body Fields for the billing item update, such as new quantity, code,
   *   description, or pricing.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":billingItemId")
  public async update(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("billingInvoiceId")
    billingInvoiceId: string & tags.Format<"uuid">,
    @TypedParam("billingItemId")
    billingItemId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IHealthcarePlatformBillingItem.IUpdate,
  ): Promise<IHealthcarePlatformBillingItem> {
    try {
      return await puthealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId(
        {
          organizationAdmin,
          billingInvoiceId,
          billingItemId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Delete a billing item from a specific billing invoice
   * (healthcare_platform_billing_items table).
   *
   * This API operation deletes a single billing item from the invoice in the
   * healthcare_platform_billing_items table. It is used by billing
   * administrators or organization finance staff to remove billing lines that
   * were added in error, are disputed, or need correction due to compliance or
   * audit requirements.
   *
   * Security is enforced to ensure only users with sufficient privileges (e.g.,
   * organizationAdmin or higher) can perform this action, and successful
   * deletion is logged for audit trails in accordance with organizational and
   * legal policy. If the schema defines a soft delete field (deleted_at), the
   * deletion is logical; otherwise, the item is removed permanently. Deletions
   * may impact invoice totals, insurance claims, and downstream financial
   * analytics, so system logic MUST ensure affected invoice and claim records
   * are accurately recalculated or marked pending review after item removal.
   *
   * Expected errors include attempting to delete an item not linked to the
   * specified invoice, deleting an item from a finalized or locked invoice, or
   * permission violations. No data is returned on successful deletion, but
   * compliance logs should track the event.
   *
   * This resource is only available to users with appropriate billing/finance
   * roles. Related operations: creating or updating billing items, viewing
   * invoice details, and adjusting invoice totals or payment plans.
   *
   * @param connection
   * @param billingInvoiceId Unique identifier for the target billing invoice
   *   (UUID format)
   * @param billingItemId Unique identifier for the billing item to delete (UUID
   *   format)
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":billingItemId")
  public async erase(
    @OrganizationadminAuth()
    organizationAdmin: OrganizationadminPayload,
    @TypedParam("billingInvoiceId")
    billingInvoiceId: string & tags.Format<"uuid">,
    @TypedParam("billingItemId")
    billingItemId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deletehealthcarePlatformOrganizationAdminBillingInvoicesBillingInvoiceIdBillingItemsBillingItemId(
        {
          organizationAdmin,
          billingInvoiceId,
          billingItemId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
