import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { patchatsRecruitmentHrRecruiterExportJobsExportJobIdDetails } from "../../../../../providers/patchatsRecruitmentHrRecruiterExportJobsExportJobIdDetails";
import { HrrecruiterAuth } from "../../../../../decorators/HrrecruiterAuth";
import { HrrecruiterPayload } from "../../../../../decorators/payload/HrrecruiterPayload";
import { getatsRecruitmentHrRecruiterExportJobsExportJobIdDetailsDetailId } from "../../../../../providers/getatsRecruitmentHrRecruiterExportJobsExportJobIdDetailsDetailId";

import { IPageIAtsRecruitmentExportJobDetail } from "../../../../../api/structures/IPageIAtsRecruitmentExportJobDetail";
import { IAtsRecruitmentExportJobDetail } from "../../../../../api/structures/IAtsRecruitmentExportJobDetail";

@Controller("/atsRecruitment/hrRecruiter/exportJobs/:exportJobId/details")
export class AtsrecruitmentHrrecruiterExportjobsDetailsController {
  /**
   * Search and retrieve a paginated list of export job detail records for a
   * specific export job (ats_recruitment_export_job_details).
   *
   * Fetch a paginated, filterable list of export job details for a specific
   * export job. Each detail represents an individual item that was included in
   * a previously requested data export (such as an applicant, application, or
   * related entity). This function provides HR administrators with the ability
   * to audit exported datasets, verify delivery completeness, and review which
   * data records were delivered.
   *
   * Security: Only HR recruiters or system administrators associated with the
   * export may access these details. Access is controlled by both the export
   * job's initiator and organizational policiesâ€”system admins may audit all
   * jobs. Details include key metadata such as the exported entity type, the
   * data row's identifying information, and the inclusion timestamp.
   *
   * This operation leverages the ats_recruitment_export_job_details table and
   * its relations, including references to export_job_id, data_row_id, and
   * summary fields.
   *
   * Filtering and pagination supports large-scale exports with thousands of
   * included items. Error and edge cases include export jobs with no delivered
   * records or in a failed state; in these cases, the response will return an
   * empty dataset with relevant status information. Related APIs include export
   * job status summaries and specific export job retrieval endpoints.
   *
   * @param connection
   * @param exportJobId Unique identifier for the parent export job to fetch
   *   details for.
   * @param body Search and filter criteria for export job detail records,
   *   including pagination and sorting options.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @HrrecruiterAuth()
    hrRecruiter: HrrecruiterPayload,
    @TypedParam("exportJobId")
    exportJobId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAtsRecruitmentExportJobDetail.IRequest,
  ): Promise<IPageIAtsRecruitmentExportJobDetail.ISummary> {
    try {
      return await patchatsRecruitmentHrRecruiterExportJobsExportJobIdDetails({
        hrRecruiter,
        exportJobId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve a specific export job detail record by exportJobId and detailId
   * (ats_recruitment_export_job_details).
   *
   * Get a specific export job detail record by providing both the export job's
   * unique ID and the detail row's unique ID. The returned record provides
   * audit-level detail, including entity identity (e.g., applicant,
   * application, resume), summarized record fields, and the timestamp when this
   * data item was exported.
   *
   * This endpoint is used by HR recruiters and system administrators to trace
   * which data rows were included in a particular export, validate data
   * delivery integrity, and support compliance reporting.
   *
   * Access control ensures only the relevant export job initiator,
   * administrative staff, or authorized compliance officers may perform this
   * operation. Underlying access control checks both the export job's
   * permissions and the export job detail's parent-child relationship.
   *
   * If the specified detail does not exist for the given export job, the system
   * returns a not found or forbidden error.
   *
   * Related APIs include export job detail listing and export summary
   * endpoints.
   *
   * @param connection
   * @param exportJobId Unique identifier for the export job this detail belongs
   *   to.
   * @param detailId Unique identifier for the export job detail row to
   *   retrieve.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":detailId")
  public async at(
    @HrrecruiterAuth()
    hrRecruiter: HrrecruiterPayload,
    @TypedParam("exportJobId")
    exportJobId: string & tags.Format<"uuid">,
    @TypedParam("detailId")
    detailId: string & tags.Format<"uuid">,
  ): Promise<IAtsRecruitmentExportJobDetail> {
    try {
      return await getatsRecruitmentHrRecruiterExportJobsExportJobIdDetailsDetailId(
        {
          hrRecruiter,
          exportJobId,
          detailId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
