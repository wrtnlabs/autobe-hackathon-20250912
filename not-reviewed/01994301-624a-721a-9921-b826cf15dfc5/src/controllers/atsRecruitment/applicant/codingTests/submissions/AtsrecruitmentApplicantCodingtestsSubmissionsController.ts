import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { putatsRecruitmentApplicantCodingTestsCodingTestIdSubmissionsSubmissionId } from "../../../../../providers/putatsRecruitmentApplicantCodingTestsCodingTestIdSubmissionsSubmissionId";
import { ApplicantAuth } from "../../../../../decorators/ApplicantAuth";
import { ApplicantPayload } from "../../../../../decorators/payload/ApplicantPayload";
import { deleteatsRecruitmentApplicantCodingTestsCodingTestIdSubmissionsSubmissionId } from "../../../../../providers/deleteatsRecruitmentApplicantCodingTestsCodingTestIdSubmissionsSubmissionId";
import { postatsRecruitmentApplicantCodingTestsCodingTestIdSubmissions } from "../../../../../providers/postatsRecruitmentApplicantCodingTestsCodingTestIdSubmissions";

import { IAtsRecruitmentCodingTestSubmission } from "../../../../../api/structures/IAtsRecruitmentCodingTestSubmission";

@Controller("/atsRecruitment/applicant/codingTests/:codingTestId/submissions")
export class AtsrecruitmentApplicantCodingtestsSubmissionsController {
  /**
   * Get a specific coding test submission from
   * ats_recruitment_coding_test_submissions by ID.
   *
   * This endpoint retrieves full information about a specific coding test
   * submission record from the system. It references the
   * ats_recruitment_coding_test_submissions table, returning all key fields
   * such as submission timestamp, answer file URL or inline code, status,
   * reviewer status, any comments, and submission history for the indicated
   * codingTestId and submissionId.
   *
   * The operation checks visibility/authorization: applicants may only access
   * their own submissions, while HR or tech reviewers can access submissions
   * linked to their assigned/tested applicants. Security is managed via
   * role-based access, and audit logs should be maintained for all access
   * events.
   *
   * If the submission does not exist, or the requester is not authorized, an
   * error is returned. Linked reviewer comments and result metadata can be
   * included in the response for authorized roles. This endpoint is related to
   * viewing, evaluating, or exporting solution content for interviews or hiring
   * decision processes.
   *
   * @param connection
   * @param codingTestId The unique ID of the parent coding test.
   * @param submissionId The unique ID of the coding test submission.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":submissionId")
  public async at(
    @TypedParam("codingTestId")
    codingTestId: string & tags.Format<"uuid">,
    @TypedParam("submissionId")
    submissionId: string & tags.Format<"uuid">,
  ): Promise<IAtsRecruitmentCodingTestSubmission> {
    codingTestId;
    submissionId;
    return typia.random<IAtsRecruitmentCodingTestSubmission>();
  }

  /**
   * Update an existing coding test submission in
   * ats_recruitment_coding_test_submissions.
   *
   * This endpoint updates properties of an existing coding test submission in
   * the ats_recruitment_coding_test_submissions table. The most common use
   * cases include technical reviewer or HR updating review status, adding
   * reviewer comments, correcting a misclassified submission, or handling edge
   * cases where re-submission is necessary before final review.
   *
   * The endpoint enforces authorization so only the relevant technical
   * reviewer, HR, or (if permitted) the original applicant can perform updates.
   * Business logic verifies that critical fields such as submitted answer are
   * not altered post-deadline except by authorized users. Audit trails must be
   * kept for all status and comment changes to ensure reviewer accountability
   * and traceability.
   *
   * Related endpoints include retrieval and reviewer comment add/edit. Update
   * operations trigger recalculation of downstream scoring and visibility
   * states as business rules dictate.
   *
   * @param connection
   * @param codingTestId The unique ID of the parent coding test.
   * @param submissionId The unique ID of the coding test submission.
   * @param body Updated submission information for the coding test submission.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":submissionId")
  public async update(
    @ApplicantAuth()
    applicant: ApplicantPayload,
    @TypedParam("codingTestId")
    codingTestId: string & tags.Format<"uuid">,
    @TypedParam("submissionId")
    submissionId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAtsRecruitmentCodingTestSubmission.IUpdate,
  ): Promise<IAtsRecruitmentCodingTestSubmission> {
    try {
      return await putatsRecruitmentApplicantCodingTestsCodingTestIdSubmissionsSubmissionId(
        {
          applicant,
          codingTestId,
          submissionId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Permanently delete a coding test submission from
   * ats_recruitment_coding_test_submissions by ID.
   *
   * This endpoint permanently deletes a coding test submission record from the
   * system using the provided codingTestId and submissionId, referencing the
   * ats_recruitment_coding_test_submissions table. This operation is typically
   * available before the submission is reviewed or in rare compliance scenarios
   * requiring data removal.
   *
   * Authentication and authorization checks ensure only the owner (applicant),
   * involved HR, technical reviewer, or system administrators can perform this
   * operation. Business logic prevents deletion after a certain workflow point
   * (such as after final review), and full audit/reporting is performed for
   * compliance.
   *
   * Irrecoverable hard deletion ensures no lingering answer or evaluation data
   * post-operation. Related endpoints include submission retrieval, update, and
   * status advances for other workflow states.
   *
   * @param connection
   * @param codingTestId The unique ID of the parent coding test.
   * @param submissionId The unique ID of the coding test submission.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":submissionId")
  public async erase(
    @ApplicantAuth()
    applicant: ApplicantPayload,
    @TypedParam("codingTestId")
    codingTestId: string & tags.Format<"uuid">,
    @TypedParam("submissionId")
    submissionId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteatsRecruitmentApplicantCodingTestsCodingTestIdSubmissionsSubmissionId(
        {
          applicant,
          codingTestId,
          submissionId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Create a new coding test submission for a coding test in
   * ats_recruitment_coding_test_submissions.
   *
   * This endpoint allows an applicant to submit their solution to a coding test
   * as a new record in the ats_recruitment_coding_test_submissions table. The
   * applicant provides the answer in text or file format, linking to the
   * codingTestId and associated application and applicant.
   *
   * Upon POST, the system validates uniqueness (prevents multiple submissions
   * unless allowed), enforces deadline/expiration checks, and sets the initial
   * status. Security rules ensure only the applicant for the relevant test can
   * submit an answer, and audit logging is performed.
   *
   * If submitted past the allowed expiry, the system rejects the submission.
   * This operation is fundamental to capturing applicant activity in the
   * recruitment workflow and integrates with downstream reviewer and scoring
   * logic.
   *
   * @param connection
   * @param codingTestId The unique ID of the parent coding test.
   * @param body New coding test submission information to be created.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @ApplicantAuth()
    applicant: ApplicantPayload,
    @TypedParam("codingTestId")
    codingTestId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAtsRecruitmentCodingTestSubmission.ICreate,
  ): Promise<IAtsRecruitmentCodingTestSubmission> {
    try {
      return await postatsRecruitmentApplicantCodingTestsCodingTestIdSubmissions(
        {
          applicant,
          codingTestId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
