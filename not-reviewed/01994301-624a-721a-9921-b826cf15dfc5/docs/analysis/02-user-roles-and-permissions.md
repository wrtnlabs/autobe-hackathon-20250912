# ATS 시스템 사용자 역할 및 권한 요구명세서

## 1. 개요 및 목적
이 문서는 ATS(지원자 추적 시스템)의 효과적인 구축과 관리를 위해, 도입 대상 시스템 내의 사용자 역할, 각 역할별 권한 범위, 인증/인가 플로우 및 토큰 기발 인증 정책을 명확히 규정한다. 모든 백엔드 개발자는 여기 명시된 비즈니스 규칙에 따라 인증 및 권한 로직을 구현해야 한다.

## 2. 사용자 역할 정의

### 2.1 역할 목록 및 권한 설명
| 역할             | 설명                                                                                          |
|------------------|----------------------------------------------------------------------------------------------|
| hrRecruiter      | 채용 공고 등록, 지원자 목록 관리, 이력서 평가, 면접 예약/조율, 지원자 상태 추적, Google Calendar 연동, 알림(이메일, 문자) 발송 처리      |
| applicant        | 이력서 업로드, 채용공고별 지원, 지원 내역/상태 확인, 면접 일정 확인, 코딩테스트 응시                        |
| techReviewer     | 지원자 코딩테스트 평가, 기술력 검증, 자동 분석 결과 확인 및 기술 코멘트 작성                   |
| systemAdmin      | 전체 ATS 시스템 환경설정, 사용자/권한 관리, 외부 API 연동 설정 등 시스템 전반 관리               |

각 역할은 상위 역할의 기능을 포함하지 않으며, 명확히 구분된 업무 영역 내에서만 행동 가능하다.

## 3. 인증/인가 플로우

### 3.1 인증 정책
- 가입 및 계정 생성: 이메일+비밀번호 기반 계정으로 등록 (applicant, hrRecruiter, techReviewer)
- 관리자(systemAdmin)는 지정된 관리자 이메일/초대코드로만 생성 가능
- 모든 사용자 인증은 JWT(JSON Web Token) 기반으로 이루어져야 한다
- 이메일 인증(OPT 또는 링크) 과정을 통해 계정 활성화 처리

### 3.2 인증 흐름(EARS 예시)
- WHEN 사용자가 이메일/비밀번호로 로그인 시도, THE 시스템 SHALL 자격 증명 유효성 검증 및 JWT 발급.
- WHEN 인증된 사용자가 서비스 접근, THE 시스템 SHALL JWT 유효성 확인 후 접근 허용.
- WHEN 인증 토큰이 만료되었을 때, THE 시스템 SHALL 갱신용 리프레시 토큰을 확인 후 새로운 액세스 토큰 재발급.
- WHEN 지원자가 비밀번호 재설정 요청, THE 시스템 SHALL 이메일 인증 후 비밀번호 재설정 가능하도록 함.
- WHEN 사용자가 로그아웃, THE 시스템 SHALL 현재 액세스 토큰 및 리프레시 토큰을 폐기함.

### 3.3 인가(Authorization) 정책 (EARS)
- WHEN 사용자가 특정 API 호출/비즈니스 행위에 접근, THE 시스템 SHALL JWT에서 역할/권한 정보를 추출하여 접근 허용/거부를 결정.
- WHEN 접근 권한이 없는 사용자가 비인가 요청, THEN THE 시스템 SHALL 403 오류와 함께 적절한 안내 메시지 제공.

## 4. 역할별 가능/불가 액션 매트릭스

| 액션/기능                                      | hrRecruiter | applicant | techReviewer | systemAdmin |
|------------------------------------------------|:-----------:|:---------:|:------------:|:-----------:|
| 채용 공고 등록/수정/삭제                       |     ✅      |    ❌     |      ❌      |     ✅      |
| 지원자 목록/상세 열람                          |     ✅      |    ❌     |      ✅      |     ✅      |
| 지원(이력서 제출)                              |     ❌      |    ✅     |      ❌      |     ❌      |
| 면접일정 등록/수정/자동조율                    |     ✅      |    ❌     |      ❌      |     ✅      |
| 코딩테스트 발송/재전송                         |     ✅      |    ❌     |      ❌      |     ✅      |
| 코딩테스트 응시                                |     ❌      |    ✅     |      ❌      |     ❌      |
| 코딩테스트 결과 열람/평가                      |     ❌      |    ❌     |      ✅      |     ✅      |
| 기술평가 코멘트 등록                           |     ❌      |    ❌     |      ✅      |     ✅      |
| 지원자 상태 변경/합불 처리                     |     ✅      |    ❌     |      ❌      |     ✅      |
| 이력서 평가/업로드/삭제                       |     ✅      |    ✅     |      ❌      |     ✅      |
| 지원 내역/상태, 면접일정 조회                  |     ✅      |    ✅     |      ✅      |     ✅      |
| 알림(이메일,문자) 발송/관리                    |     ✅      |    ❌     |      ❌      |     ✅      |
| Google Calendar 연동                          |     ✅      |    ❌     |      ❌      |     ✅      |
| 환경설정, 외부 API 연동관리, 권한관리          |     ❌      |    ❌     |      ❌      |     ✅      |
| 시스템 사용자 생성/삭제                        |     ❌      |    ❌     |      ❌      |     ✅      |

## 5. JWT 명세와 토큰 정책

### 5.1 토큰 구조 및 만료 정책(EARS)
- THE 시스템 SHALL JWT를 액세스 토큰(15~30분 만료)과 리프레시 토큰(7~30일 만료) 2종류로 발급.
- WHEN 사용자가 로그인 성공, THE 시스템 SHALL JWT 액세스/리프레시 토큰을 응답하며, JWT payload에 반드시 userId, role, permissions array를 포함.
- Access token은 localStorage(일반 사용자) 또는 httpOnly cookie(보안이 요구되는 환경) 둘 다 지원 가능하도록 설계.
- WHEN 리프레시 토큰이 만료 또는 불일치할 시, THEN THE 시스템 SHALL 모든 세션을 강제 만료 및 재로그인을 요구.
- JWT secret key는 반드시 별도 보안 환경변수로 관리하며, code에 하드코딩 금지(EARS).

#### JWT 페이로드 예시
```json
{
  "userId": "UUID 형식",
  "role": "예: applicant, hrRecruiter, techReviewer, systemAdmin",
  "permissions": ["채용공고열람", "이력서평가", ...],
  "exp": 1713399600
}
```

### 5.2 권한 검증(EARS)
- WHEN 요청마다 JWT에서 role/permissions 확인, THE 시스템 SHALL 비즈니스 정책에 따라 액션 허용 또는 403, 401 반환.
- WHEN 토큰 유효성 검증 실패, THE 시스템 SHALL 401(인증실패), 403(권한없음) 코드와 오류사유를 안내문과 함께 반환.


## 6. 부가 비즈니스 규칙 및 예외
- 관리자 계정은 반드시 2인 이상 존재해야 하며, 단일 관리자 존재 시 삭제 및 권한 위임 불가능(EARS)
- 지원자가 탈퇴/삭제 시, 관련 데이터는 익명화 또는 자동 파기(EARS)
- 모든 주요 변경(채용공고/상태/권한/환경설정 등)에는 이력 로그가 반드시 기록되고, 1년간 보관(EARS)
- 외부 서비스와의 연동정보(OAuth, API Key 등)는 관리자만 접근 및 수정 가능(EARS)

## 7. 관련 문서 링크
- 서비스 전체 비전, 시장분석은 [서비스 개요 문서](./01-service-overview.md) 참고
- 상세 기능 프로세스와 업무흐름은 [기능 요구명세서](./03-functional-requirements.md) 및 [사용자 플로우/시나리오 문서](./04-user-stories-and-flows.md) 참고
- 코딩테스트, 알림, Google 캘린더 연동 등 외부시스템은 [외부 연동 요구 명세](./06-external-integrations.md) 참고
- 상세 비즈니스 룰/정책은 [비즈니스 룰 및 정책 문서](./05-business-rules-and-policies.md) 참고
- 예외상황 처리, 복구 등은 [에러 핸들링 및 복구 문서](./07-error-handling-and-recovery.md) 참고
- 시스템 성능, 확장성, 보안 및 규정 준수는 [성능 및 확장성 문서](./08-performance-and-scalability.md), [보안/개인정보/컴플라이언스 요구 명세](./09-security-and-compliance.md) 각 문서를 참고

