/// OCR ingestion jobs represent asynchronous requests to convert essay blobs
/// such as PDFs or images into text. Each job is uniquely identified by a
/// UUID and associated with a tenant and a source essay blob. The model
/// tracks the OCR processing lifecycle through status fields, optional error
/// messages for diagnostics, start and finish timestamps, and usual created,
/// updated, and soft deletion timestamps. The entity serves as a primary
/// domain object reflecting OCR processing pipeline states independent from
/// essay or grading workflows.
///
/// @namespace Ocr
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model creverse_ai_essay_ocr_jobs {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Tenant that owns this OCR job, ensuring strict multi-tenant data
  /// isolation. Foreign key references creverse_ai_essay_tenants.id.
  tenant_id String
  
  /// Reference to the essay blob (PDF or image) to process in this OCR job.
  /// Foreign key to creverse_ai_essay_essay_blobs.id.
  blob_id String
  
  /// Current state of the OCR job such as 'queued', 'processing', 'succeeded',
  /// or 'failed'. Enables tracking and workflow management.
  status String
  
  /// Optional detailed error message if OCR processing failed. Useful for
  /// troubleshooting and retry logic.
  error_message String?
  
  /// Timestamp when OCR processing started. Null if processing not yet begun.
  started_at DateTime?
  
  /// Timestamp when OCR processing completed. Null if job pending or failed.
  finished_at DateTime?
  
  /// Timestamp when this OCR job was created.
  created_at DateTime
  
  /// Timestamp when this OCR job was last updated.
  updated_at DateTime
  
  /// Soft deletion timestamp; null if not deleted.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  tenant creverse_ai_essay_tenants @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  blob creverse_ai_essay_essay_blobs @relation(fields: [blob_id], references: [id], onDelete: Cascade)
  
  creverse_ai_essay_ocr_results creverse_ai_essay_ocr_results[]
  
  @@index([blob_id])
  
  @@unique([tenant_id, blob_id])
  @@index([status, created_at])
}

/// OCR results contain extracted text from OCR jobs linked to specific essay
/// versions generated by processing blobs. Each result record uniquely
/// identifies the OCR job it belongs to and the resultant essay version. The
/// model stores the plain text output, optional detected language, and
/// timestamps for creation, updates, and soft deletion. This primary entity
/// supports independent querying and management of OCR results in the essay
/// processing pipeline.
///
/// @namespace Ocr
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model creverse_ai_essay_ocr_results {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Foreign key referencing the OCR job that generated this result. Links to
  /// creverse_ai_essay_ocr_jobs.id.
  ocr_job_id String
  
  /// Foreign key referencing the essay version created from this OCR text.
  /// Links to creverse_ai_essay_essay_versions.id.
  essay_version_id String
  
  /// Extracted OCR plain text content from essay blobs.
  text String
  
  /// Detected or specified language of the OCR text such as 'en' or 'fr'.
  /// Facilitates language-based filtering and processing. Nullable if unknown.
  language String?
  
  /// Timestamp when the OCR result record was created.
  created_at DateTime
  
  /// Timestamp when the OCR result record was last updated.
  updated_at DateTime
  
  /// Soft deletion timestamp; null if not deleted.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  ocrJob creverse_ai_essay_ocr_jobs @relation(fields: [ocr_job_id], references: [id], onDelete: Cascade)
  essayVersion creverse_ai_essay_essay_versions @relation(fields: [essay_version_id], references: [id], onDelete: Cascade)
  
  @@index([essay_version_id])
  
  @@unique([ocr_job_id])
  @@index([language])
}