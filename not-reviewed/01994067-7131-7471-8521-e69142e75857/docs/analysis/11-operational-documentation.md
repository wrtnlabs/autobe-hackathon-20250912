# OAuth Server 비즈니스 및 기능 요구사항

## 1. 서비스 개요 및 비즈니스 모델

- OAuth 2.0 및 OpenID Connect 1.0 표준을 준수하는 인증 및 인가 서버 제공
- 개발자가 5분 내에 연동 가능한 간결하고 신뢰성 높은 서비스 구축
- 자체 이메일 로그인과 주요 소셜 로그인(네이버, 다음, 애플, 구글) 완전 지원
- 공식 게임 API와 연동된 배틀그라운드, 롤 전적 검색 기능 포함
- 포인트 시스템과 쿠폰 기능으로 디지털 아이템 구매 지원
- Redis 캐싱을 통한 성능 최적화 및 빈번한 데이터 조회 가속

## 2. 사용자 역할 및 권한

| 역할       | 설명                     | 권한 및 기능
|------------|--------------------------|-------------
| guest      | 비인증 사용자            | 로그인, 회원가입, 공개 데이터 조회
| member     | 인증된 사용자            | 프로필 관리, OAuth 토큰 발급 및 갱신
| admin      | 관리자                  | 사용자/클라이언트 관리, 감사 로그 조회
| developer  | 개발자 및 클라이언트    | 클라이언트 등록, SDK 사용, API 통합

## 3. 주요 기능 요구사항

### 3.1 OAuth 인증 및 인가 플로우
- 인가 코드 발급과 토큰 교환 지원
- opaque 토큰(access_token, refresh_token)으로 UUID, CUID, ULID 사용
- 로그인 상태 확인, 신뢰 클라이언트 자동 동의 처리
- 스코프 및 리다이렉트 URI 검증

### 3.2 사용자 관리
- 이메일/비밀번호 로그인과 소셜 로그인 통합
- 동일 이메일을 기준으로 다수 소셜 로그인 계정 연동
- 프로필에 게임 플레이어명 저장(Steam, Kakao 배그, 롤)
- 닉네임, 프로필사진은 별도 프로필 테이블로 관리

### 3.3 클라이언트 관리
- 클라이언트 등록, 수정, 삭제 및 시크릿 재생성 기능
- redirect_uri 및 스코프 유효성 검사
- soft delete 지원 (deletedAt 컬럼)

### 3.4 토큰 관리
- access_token, refresh_token opaque 토큰으로 발급
- Redis 캐시 활용으로 토큰 검증 최적화

### 3.5 소셜 로그인 및 OAuth 외부 서버 연동
- 네이버, 다음, 애플, 구글 소셜 로그인 지원
- 자체 OAuth 서버도 외부 서비스가 클라이언트로 사용할 수 있도록 지원
- 관리자 UI에서 소셜 로그인 공급자 정보 관리 가능

### 3.6 게임 전적 검색 기능
- 공식 API로 배틀그라운드, 롤 전적 데이터 조회
- 시즌별 전적 데이터 필터링 지원
- Redis 캐싱으로 응답 시간 개선

### 3.7 포인트 및 쿠폰 시스템
- 사용자별 포인트 적립 및 사용 내역 관리
- 아이콘 구매 지원
- 쿠폰 코드 입력 시 포인트 지급 기능
- 쿠폰 유효성 및 만료 관리

### 3.8 Redis 및 캐싱 전략
- 토큰, 사용자 정보, 클라이언트 정보, 외부 API 데이터 캐싱
- TTL 지정과 캐시 무효화 지원

## 4. 보안 및 감사

- 프로덕션 환경 HTTPS 강제
- PKCE 지원과 클라이언트 인증
- Rate Limiting(IP/클라이언트별)
- 감사 로그 수집 및 보안 사고 대비
- 민감 정보 로깅 금지

## 5. 운영 및 관리 기능

- 클라이언트, 사용자 관리 페이지 제공
- 토큰 모니터링 및 이상 징후 감지
- 감사 로그 조회 및 자동 보고
- 관리자 인증과 역할 기반 접근 제어

## 6. 개발자 문서 및 테스트 계획

- QUICK-START 가이드, API 테스터 페이지, SDK 자동 생성
- Playwright 기반 프론트엔드 E2E 테스트
- 단위 및 통합 테스트 계획 포함

## 7. 성능 및 성공 기준

- 토큰 응답 시간 100ms 이하
- 100동시 요청 이상 안정적 처리
- 5분 내 OAuth 연동 가능
- 한글 에러 메시지 및 해결 안내 제공

## Mermaid 다이어그램: OAuth 인가 및 토큰 플로우

```mermaid
graph LR
  subgraph "OAuth 인가 코드 플로우"
    A["사용자 OAuth 인가 요청"] --> B{"로그인 상태 확인"}
    B --|"미인증"| C["로그인 페이지 리다이렉트"]
    B --|"인증됨"| D["클라이언트 신뢰 여부 확인"]
    D --|"신뢰"| E["자동 동의 처리"]
    D --|"비신뢰"| F["동의 화면 표시"]
    E --> G["인가 코드 생성 및 저장"]
    F --> G
    G --> H["클라이언트 리다이렉트"]
  end

  subgraph "토큰 발급 및 검증"
    I["인가 코드 교환 요청"] --> J["인가 코드, 클라이언트 인증 검증"]
    J --> K["서버측 토큰 발급(opaque) UUID/CUID/ULID 사용"]
    K --> L["토큰 응답 반환"]
  end

  subgraph "UserInfo 조회"
    M["UserInfo 요청"] --> N["토큰 유효성 및 스코프 검증"]
    N --> O["사용자 정보 클레임 필터링 및 반환"]
  end

  A --> B
  C --> B
  L --> M

```

---

본 문서는 OAuth 서버 비즈니스 및 기능 요구사항을 상세히 명시한다. 기술 구현 세부사항은 개발자 담당이며, 구현에 필요한 모든 구체적 요구를 담아 즉시 개발에 착수할 수 있다.

This document provides business requirements only. All technical implementation decisions belong to developers. Developers have full autonomy over architecture, APIs, and database design. The document describes WHAT the system should do, not HOW to build it.
