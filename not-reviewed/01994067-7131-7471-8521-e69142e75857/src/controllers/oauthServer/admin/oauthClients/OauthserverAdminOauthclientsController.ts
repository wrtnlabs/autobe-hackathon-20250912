import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { postoauthServerAdminOauthClients } from "../../../../providers/postoauthServerAdminOauthClients";
import { AdminAuth } from "../../../../decorators/AdminAuth";
import { AdminPayload } from "../../../../decorators/payload/AdminPayload";
import { patchoauthServerAdminOauthClients } from "../../../../providers/patchoauthServerAdminOauthClients";
import { getoauthServerAdminOauthClientsId } from "../../../../providers/getoauthServerAdminOauthClientsId";
import { putoauthServerAdminOauthClientsId } from "../../../../providers/putoauthServerAdminOauthClientsId";
import { deleteoauthServerAdminOauthClientsId } from "../../../../providers/deleteoauthServerAdminOauthClientsId";

import { IOauthServerOauthClient } from "../../../../api/structures/IOauthServerOauthClient";
import { IPageIOauthServerOauthClient } from "../../../../api/structures/IPageIOauthServerOauthClient";

@Controller("/oauthServer/admin/oauthClients")
export class OauthserverAdminOauthclientsController {
  /**
   * Create a new OAuth client by providing client credentials and metadata.
   * This operation is restricted to authorized developers and administrators.
   *
   * The client_id must be unique and redirect_uri valid. The is_trusted flag
   * determines if automatic consent is granted during OAuth flows.
   *
   * Successful creation returns the full client record including creation
   * timestamps. Failure occurs if validation fails or the client_id already
   * exists.
   *
   * This operation interacts directly with the 'oauth_server_oauth_clients'
   * table for data persistence.
   *
   * @param connection
   * @param body Client creation data including client_id, client_secret,
   *   redirect_uri, logo_uri, and trust flag
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IOauthServerOauthClient.ICreate,
  ): Promise<IOauthServerOauthClient> {
    try {
      return await postoauthServerAdminOauthClients({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Search and retrieve paginated OAuth clients.
   *
   * Retrieve a filtered and paginated list of OAuth clients registered in the
   * system. Clients are returned with summary profile information and key OAuth
   * client fields.
   *
   * This operation supports search, sorting, and pagination to efficiently
   * manage large client sets.
   *
   * Security enforces that only administrators or authorized developers access
   * client data.
   *
   * Soft deleted clients are excluded from responses. Filters may include
   * client_id, trusted status, and created date ranges.
   *
   * Errors are returned for invalid filter parameters.
   *
   * @param connection
   * @param body Search criteria and pagination parameters for OAuth clients
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IOauthServerOauthClient.IRequest,
  ): Promise<IPageIOauthServerOauthClient.ISummary> {
    try {
      return await patchoauthServerAdminOauthClients({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve a specific OAuth client by ID.
   *
   * Retrieve detailed information of a specific OAuth client by its unique
   * identifier. This endpoint allows authorized personnel such as developers
   * and admins to access client metadata necessary for management and auditing
   * purposes.
   *
   * Security considerations require authentication and role-based access to
   * protect the client secret and related sensitive data. Only authenticated
   * developers or admins may perform this operation.
   *
   * The data is sourced from the 'oauth_server_oauth_clients' table, which
   * maintains the core client credentials and associated metadata. The response
   * excludes client profiles which are managed separately.
   *
   * Errors may occur if the client ID does not exist or access is unauthorized.
   * Proper HTTP error codes and messages will be returned accordingly.
   *
   * @param connection
   * @param id Unique identifier of the OAuth client to retrieve
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":id")
  public async at(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("id")
    id: string & tags.Format<"uuid">,
  ): Promise<IOauthServerOauthClient> {
    try {
      return await getoauthServerAdminOauthClientsId({
        admin,
        id,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing OAuth client by ID.
   *
   * Update an existing OAuth client's credentials and metadata by specifying
   * its unique ID. Authorized developers and admins can modify client secret,
   * redirect URI, logo URI, and trust status.
   *
   * This operation validates inputs and updates the
   * 'oauth_server_oauth_clients' table accordingly with new timestamps.
   *
   * The client_id field is immutable and cannot be changed by this operation.
   *
   * Errors arise if the client does not exist or user lacks permission.
   *
   * @param connection
   * @param id Unique identifier of the OAuth client to update
   * @param body Client update data with modifiable fields
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":id")
  public async update(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("id")
    id: string & tags.Format<"uuid">,
    @TypedBody()
    body: IOauthServerOauthClient.IUpdate,
  ): Promise<IOauthServerOauthClient> {
    try {
      return await putoauthServerAdminOauthClientsId({
        admin,
        id,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Soft delete an OAuth client by ID.
   *
   * Soft delete an OAuth client by setting its deletion timestamp. This marks
   * the client as inactive and excludes it from OAuth processes without
   * permanently removing data.
   *
   * Only authorized developers and admins may perform this operation.
   *
   * Proper error handling is included for non-existent clients or unauthorized
   * access attempts.
   *
   * @param connection
   * @param id Unique identifier of the OAuth client to delete
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":id")
  public async erase(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("id")
    id: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteoauthServerAdminOauthClientsId({
        admin,
        id,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
