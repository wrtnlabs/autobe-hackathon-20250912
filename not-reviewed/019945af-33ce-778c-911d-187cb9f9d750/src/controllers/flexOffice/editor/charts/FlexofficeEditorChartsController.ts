import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { postflexOfficeEditorCharts } from "../../../../providers/postflexOfficeEditorCharts";
import { EditorAuth } from "../../../../decorators/EditorAuth";
import { EditorPayload } from "../../../../decorators/payload/EditorPayload";
import { patchflexOfficeEditorCharts } from "../../../../providers/patchflexOfficeEditorCharts";
import { getflexOfficeEditorChartsChartId } from "../../../../providers/getflexOfficeEditorChartsChartId";
import { putflexOfficeEditorChartsChartId } from "../../../../providers/putflexOfficeEditorChartsChartId";
import { deleteflexOfficeEditorChartsChartId } from "../../../../providers/deleteflexOfficeEditorChartsChartId";

import { IFlexOfficeChart } from "../../../../api/structures/IFlexOfficeChart";
import { IPageIFlexOfficeChart } from "../../../../api/structures/IPageIFlexOfficeChart";

@Controller("/flexOffice/editor/charts")
export class FlexofficeEditorChartsController {
  /**
   * Create a new analytics chart in the FlexOffice system.
   *
   * This API endpoint allows the creation of a new analytics chart within the
   * FlexOffice platform. The chart entity acts as the foundational metadata
   * container for visualization widgets associated with UI page widgets. Users
   * can specify the chart type such as bar, line, or pie, set a meaningful
   * title, and optionally provide a description to inform viewers of the
   * chart's context and purpose.
   *
   * Security-wise, this operation requires authenticated user access restricted
   * to roles 'admin', 'editor', or 'viewer' to ensure authorized users can
   * manage chart metadata.
   *
   * The created chart will be linked to an existing UI widget by ID and stored
   * atomically in the database, ensuring data integrity. Backend services are
   * responsible for generating unique IDs, timestamps, and managing soft
   * deletion flags where applicable.
   *
   * This operation complements related operations such as updating charts,
   * deleting charts, and retrieving chart details or summaries. Error handling
   * includes validation of widget existence and chart type correctness.
   *
   * The response returns the fully created chart entity with all relevant
   * fields.
   *
   * @param connection
   * @param body Detailed information for creating a FlexOffice chart
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @EditorAuth()
    editor: EditorPayload,
    @TypedBody()
    body: IFlexOfficeChart.ICreate,
  ): Promise<IFlexOfficeChart> {
    try {
      return await postflexOfficeEditorCharts({
        editor,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Search and retrieve a paginated list of analytics charts.
   *
   * Retrieve a filtered and paginated list of analytics chart metadata records.
   * Provides users with the ability to find charts by type, title, or other
   * criteria to support dashboard construction.
   *
   * Security restricts access to authenticated users with viewing permission.
   * The paginated response optimizes client-side loading and rendering.
   *
   * Underlying data resides in the flex_office_charts table, including chart
   * type, title, description, creation, and update timestamps. Soft-deleted
   * charts are excluded by default.
   *
   * This operation supports analytical dashboard building and enhances
   * reusability of chart components.
   *
   * @param connection
   * @param body Search and pagination parameters for charts filtering
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @EditorAuth()
    editor: EditorPayload,
    @TypedBody()
    body: IFlexOfficeChart.IRequest,
  ): Promise<IPageIFlexOfficeChart> {
    try {
      return await patchflexOfficeEditorCharts({
        editor,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve a specific analytics chart by ID.
   *
   * Retrieve detailed information of a specific analytics chart by its unique
   * ID. The response includes all chart metadata fields stored in the
   * database.
   *
   * Only users with proper authorization (Editor or Admin) may access this
   * endpoint. This facilitates detailed inspection and dashboard customization
   * tasks.
   *
   * Parameter validation ensures proper UUID format. The response payload
   * includes chart details for client consumption.
   *
   * This operation is fundamental for analytics dashboard management and
   * component reusability.
   *
   * @param connection
   * @param chartId Unique identifier of the target chart
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":chartId")
  public async at(
    @EditorAuth()
    editor: EditorPayload,
    @TypedParam("chartId")
    chartId: string & tags.Format<"uuid">,
  ): Promise<IFlexOfficeChart> {
    try {
      return await getflexOfficeEditorChartsChartId({
        editor,
        chartId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing analytics chart by chartId.
   *
   * This API endpoint updates the attributes of an existing analytics chart in
   * the FlexOffice platform. By specifying the chart ID, authorized users such
   * as admin, editor, or viewer roles can modify properties such as chart type,
   * descriptive title, and optional descriptive fields to keep visualizations
   * accurate and relevant.
   *
   * Strict access control is enforced ensuring that only authorized users with
   * roles 'admin', 'editor', or 'viewer' can perform modifications to prevent
   * unauthorized data tampering.
   *
   * The system will validate the existence of the target chart prior to
   * applying updates and return the updated entity in the response. This
   * operation serves as a complement to chart creation, deletion, and retrieval
   * endpoints.
   *
   * Errors include handling cases of not found chart ID or invalid update data.
   *
   * @param connection
   * @param chartId Unique identifier of the target chart to update
   * @param body Update data for an existing FlexOffice chart
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":chartId")
  public async update(
    @EditorAuth()
    editor: EditorPayload,
    @TypedParam("chartId")
    chartId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IFlexOfficeChart.IUpdate,
  ): Promise<IFlexOfficeChart> {
    try {
      return await putflexOfficeEditorChartsChartId({
        editor,
        chartId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Delete an analytics chart permanently by chartId.
   *
   * This API endpoint permanently removes a FlexOffice chart from the system by
   * its unique identifier. The operation is a hard delete that will erase all
   * associated data with the chart, making it unrecoverable. Only authorized
   * users such as admin, editor, or viewer may perform this action to protect
   * data integrity and comply with permission policies.
   *
   * The operation expects the target chart to exist; otherwise, an error will
   * be returned. It complements other chart management endpoints such as
   * create, update, and retrieve. No request body is required.
   *
   * Care must be taken to handle cascading effects on dependent entities, such
   * as filter conditions or linked widgets, which should also be cleaned up by
   * backend transactional logic.
   *
   * @param connection
   * @param chartId Unique identifier of the target chart to delete
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":chartId")
  public async erase(
    @EditorAuth()
    editor: EditorPayload,
    @TypedParam("chartId")
    chartId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteflexOfficeEditorChartsChartId({
        editor,
        chartId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
