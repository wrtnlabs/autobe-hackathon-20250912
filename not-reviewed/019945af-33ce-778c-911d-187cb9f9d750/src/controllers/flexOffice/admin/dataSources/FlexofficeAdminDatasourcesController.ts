import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { postflexOfficeAdminDataSources } from "../../../../providers/postflexOfficeAdminDataSources";
import { AdminAuth } from "../../../../decorators/AdminAuth";
import { AdminPayload } from "../../../../decorators/payload/AdminPayload";
import { patchflexOfficeAdminDataSources } from "../../../../providers/patchflexOfficeAdminDataSources";
import { getflexOfficeAdminDataSourcesDataSourceId } from "../../../../providers/getflexOfficeAdminDataSourcesDataSourceId";
import { putflexOfficeAdminDataSourcesDataSourceId } from "../../../../providers/putflexOfficeAdminDataSourcesDataSourceId";
import { deleteflexOfficeAdminDataSourcesDataSourceId } from "../../../../providers/deleteflexOfficeAdminDataSourcesDataSourceId";

import { IFlexOfficeDataSource } from "../../../../api/structures/IFlexOfficeDataSource";
import { IPageIFlexOfficeDataSource } from "../../../../api/structures/IPageIFlexOfficeDataSource";

@Controller("/flexOffice/admin/dataSources")
export class FlexofficeAdminDatasourcesController {
  /**
   * Create a new data source configuration.
   *
   * Create a new external data source configuration, supporting types like
   * MySQL, PostgreSQL, Google Sheets, and Excel.
   *
   * The input includes connection information and activation flag. Proper
   * validation of input data is expected.
   *
   * The operation returns the newly created data source record with all
   * properties as stored in the database.
   *
   * Only authorized roles can perform creation to ensure system integrity.
   *
   * Corresponds to the flex_office_data_sources Prisma schema table.
   *
   * @param connection
   * @param body Data source creation input data
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IFlexOfficeDataSource.ICreate,
  ): Promise<IFlexOfficeDataSource> {
    try {
      return await postflexOfficeAdminDataSources({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Search and retrieve a list of data sources with filtering and pagination
   * support.
   *
   * Retrieve a filtered, paginated list of external data sources registered in
   * the system. This includes databases, Google Sheets, Excel uploads, and
   * other supported types.
   *
   * Clients can specify search terms, filter by data source type (e.g., mysql,
   * postgresql, google_sheet, excel), and limit results by active status.
   * Pagination parameters allow controlling page size and the specific page.
   *
   * Security policies restrict this operation to authorized users with the
   * appropriate role.
   *
   * The operation returns summary information optimized for listing including
   * id, name, type, and active status.
   *
   * This operation corresponds directly to the flex_office_data_sources table
   * as defined in the Prisma schema.
   *
   * @param connection
   * @param body Search criteria and pagination parameters for data source
   *   filtering
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IFlexOfficeDataSource.IRequest,
  ): Promise<IPageIFlexOfficeDataSource.ISummary> {
    try {
      return await patchflexOfficeAdminDataSources({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve detailed data source information by ID.
   *
   * Get detailed information of an external data source by its unique
   * identifier. The data source can be of type MySQL, PostgreSQL, Google
   * Sheets, Excel, etc.
   *
   * The operation retrieves full configuration details, connection credentials
   * reference, activation status, and audit data.
   *
   * This API ensures that only authorized users can access sensitive data
   * source configurations.
   *
   * Relationship exists with data source syncs, credentials, and external
   * sheets enumerated separately.
   *
   * Returns the full data source record from the flex_office_data_sources
   * table, matching the Prisma schema structure.
   *
   * @param connection
   * @param dataSourceId Unique identifier of the target data source
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":dataSourceId")
  public async at(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("dataSourceId")
    dataSourceId: string & tags.Format<"uuid">,
  ): Promise<IFlexOfficeDataSource> {
    try {
      return await getflexOfficeAdminDataSourcesDataSourceId({
        admin,
        dataSourceId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing data source configuration.
   *
   * Update an existing data source's configuration given its unique identifier.
   *
   * The input body includes editable fields. The record is updated accordingly.
   *
   * The operation returns the updated data source object.
   *
   * Authorization restricted to admin and editor roles for security reasons.
   *
   * Matches the Prisma schema structure for flex_office_data_sources updates.
   *
   * @param connection
   * @param dataSourceId Unique identifier of the data source to update
   * @param body Data source update input data
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":dataSourceId")
  public async update(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("dataSourceId")
    dataSourceId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IFlexOfficeDataSource.IUpdate,
  ): Promise<IFlexOfficeDataSource> {
    try {
      return await putflexOfficeAdminDataSourcesDataSourceId({
        admin,
        dataSourceId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Hard delete a data source by dataSourceId.
   *
   * This API endpoint allows authorized users to permanently delete a data
   * source in the FlexOffice platform by specifying its unique identifier.
   *
   * The data source entity represents external databases or spreadsheets
   * connected for integration. Deleting a data source removes all associated
   * connection settings, credentials, sync schedules, and audit logs. This
   * operation should only be performed by users with sufficient permissions as
   * deletion is irreversible.
   *
   * Security-wise, only users with high-level roles such as administrators
   * should be authorized to perform this deletion to avoid accidental loss of
   * important integration links.
   *
   * Since the schema includes a 'deleted_at' field, this operation enforces
   * hard deletion, permanently erasing the record to maintain data integrity
   * and prevent orphaned relations.
   *
   * Users of this API should ensure that related data is adequately backed up
   * or no longer needed, as once deleted, data cannot be restored by this API.
   *
   * Related endpoints include retrieving data source details (GET
   * /dataSources/{dataSourceId}) and managing credentials for a given data
   * source.
   *
   * Potential errors include attempting to delete a non-existent data source or
   * lacking proper authorization.
   *
   * This operation does not require a request body and does not return any
   * content.
   *
   * @param connection
   * @param dataSourceId Unique identifier of the data source to delete
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":dataSourceId")
  public async erase(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("dataSourceId")
    dataSourceId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteflexOfficeAdminDataSourcesDataSourceId({
        admin,
        dataSourceId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
